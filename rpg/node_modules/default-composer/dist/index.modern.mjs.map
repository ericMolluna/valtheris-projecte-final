{"version":3,"file":"index.modern.mjs","sources":["../src/index.ts"],"sourcesContent":["export type isDefaultableValueInputType = {\n  defaultableValue: boolean;\n  key: PropertyKey;\n  value: unknown;\n};\n\nexport type isDefaultableValueType = ({\n  defaultableValue,\n  key,\n  value,\n}: isDefaultableValueInputType) => boolean;\n\nexport type Config = {\n  isDefaultableValue?: isDefaultableValueType;\n  mergeArrays?: boolean;\n};\n\nlet config: Config = {};\n\nexport function setConfig(newConfig: Config): void {\n  config = newConfig;\n}\n\nexport function defaultComposer<T>(...args: Partial<T>[]): T {\n  return args.reduce(compose, args[0]) as T;\n}\n\nfunction compose<T>(defaults: Partial<T>, obj: Partial<T>): Partial<T> {\n  const result: Partial<T> = {};\n  const allKeys = new Set([defaults, obj].flatMap(getAllKeys));\n\n  for (let key of allKeys) {\n    const defaultsValue = defaults[key];\n    const originalObjectValue = hasOwn(obj, key) ? obj[key] : undefined;\n    const hasDefault = hasOwn(defaults, key);\n    const checkOptions = { key, value: originalObjectValue };\n    const defaultableValue = checkDefaultableValue(checkOptions);\n    const defaultableValueFromConfig =\n      config.isDefaultableValue?.({ ...checkOptions, defaultableValue }) ??\n      defaultableValue;\n\n    const shouldTakeDefault = hasDefault && defaultableValueFromConfig;\n\n    if (\n      shouldTakeDefault &&\n      config.mergeArrays &&\n      Array.isArray(defaultsValue) &&\n      Array.isArray(originalObjectValue)\n    ) {\n      result[key] = [...new Set([...defaultsValue, ...originalObjectValue])];\n      continue;\n    }\n\n    if (shouldTakeDefault) {\n      result[key] = defaultsValue;\n      continue;\n    }\n\n    if (isObject(defaultsValue) && isObject(originalObjectValue)) {\n      result[key] = compose(defaultsValue, originalObjectValue);\n      continue;\n    }\n\n    result[key] = originalObjectValue;\n  }\n\n  return result;\n}\n\nfunction isObject(value: any): boolean {\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\n}\n\nfunction isEmptyObjectOrArray<T>(object: T): boolean {\n  if (typeof object !== \"object\" || object === null) return false;\n  return getAllKeys(object).length === 0;\n}\n\nfunction checkDefaultableValue({ value }: { value: unknown }): boolean {\n  return (\n    value === undefined ||\n    value === \"\" ||\n    value === null ||\n    isEmptyObjectOrArray(value) ||\n    (Boolean(config.mergeArrays) && Array.isArray(value))\n  );\n}\n\nfunction hasOwn<T extends PropertyKey>(\n  obj: Partial<Record<T, unknown>>,\n  key: unknown,\n): key is T {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nfunction getAllKeys(object: {}): PropertyKey[] {\n  return [\n    ...Object.keys(object),\n    ...Object.getOwnPropertySymbols(object).filter(\n      (key) => Object.getOwnPropertyDescriptor(object, key)?.enumerable,\n    ),\n  ];\n}\n"],"names":["config","setConfig","newConfig","defaultComposer","args","reduce","compose","defaults","obj","result","allKeys","Set","flatMap","getAllKeys","key","_config$isDefaultable","defaultsValue","originalObjectValue","hasOwn","undefined","hasDefault","checkOptions","value","defaultableValue","checkDefaultableValue","defaultableValueFromConfig","isDefaultableValue","_extends","shouldTakeDefault","mergeArrays","Array","isArray","isObject","object","length","Boolean","Object","prototype","hasOwnProperty","call","keys","getOwnPropertySymbols","filter","_Object$getOwnPropert","getOwnPropertyDescriptor","enumerable"],"mappings":"oOAiBA,IAAIA,EAAiB,CAAE,EAEjB,SAAUC,EAAUC,GACxBF,EAASE,CACX,UAEgBC,KAAsBC,GACpC,OAAOA,EAAKC,OAAOC,EAASF,EAAK,GACnC,CAEA,SAASE,EAAWC,EAAsBC,GACxC,MAAMC,EAAqB,CAAA,EACrBC,EAAU,IAAIC,IAAI,CAACJ,EAAUC,GAAKI,QAAQC,IAEhD,IAAK,IAAIC,KAAOJ,EAAS,CAAAK,IAAAA,EACvB,MAAMC,EAAgBT,EAASO,GACzBG,EAAsBC,EAAOV,EAAKM,GAAON,EAAIM,QAAOK,EACpDC,EAAaF,EAAOX,EAAUO,GAC9BO,EAAe,CAAEP,MAAKQ,MAAOL,GAC7BM,EAAmBC,EAAsBH,GACzCI,EAC8D,OADpCV,EACL,MAAzBf,EAAO0B,wBAAkB,EAAzB1B,EAAO0B,mBAAkBC,EAAQN,CAAAA,EAAAA,EAAcE,CAAAA,uBAAmBR,EAClEQ,EAEIK,EAAoBR,GAAcK,EAQtChB,EAAOK,GALPc,GACA5B,EAAO6B,aACPC,MAAMC,QAAQf,IACdc,MAAMC,QAAQd,GAEA,IAAI,IAAIN,IAAI,IAAIK,KAAkBC,KAI9CW,EACYZ,EAIZgB,EAAShB,IAAkBgB,EAASf,GACxBX,EAAQU,EAAeC,GAIzBA,CACf,CAED,OAAOR,CACT,CAEA,SAASuB,EAASV,GAChB,MAAwB,iBAAVA,GAAgC,OAAVA,IAAmBQ,MAAMC,QAAQT,EACvE,CAOA,SAASE,GAAsBF,MAAEA,IAC/B,YACYH,IAAVG,GACU,KAAVA,GACU,OAAVA,GARoB,iBADSW,EAURX,IATsB,OAAXW,GACG,IAA9BpB,EAAWoB,GAAQC,QASvBC,QAAQnC,EAAO6B,cAAgBC,MAAMC,QAAQT,GAXlD,IAAiCW,CAajC,CAEA,SAASf,EACPV,EACAM,GAEA,OAAOsB,OAAOC,UAAUC,eAAeC,KAAK/B,EAAKM,EACnD,CAEA,SAASD,EAAWoB,GAClB,MAAO,IACFG,OAAOI,KAAKP,MACZG,OAAOK,sBAAsBR,GAAQS,OACrC5B,IAAG,IAAA6B,EAAA,OAAiD,OAAjDA,EAAKP,OAAOQ,yBAAyBX,EAAQnB,SAAI,EAA5C6B,EAA8CE,aAG7D"}