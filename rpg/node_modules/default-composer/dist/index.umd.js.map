{"version":3,"file":"index.umd.js","sources":["../src/index.ts"],"sourcesContent":["export type isDefaultableValueInputType = {\n  defaultableValue: boolean;\n  key: PropertyKey;\n  value: unknown;\n};\n\nexport type isDefaultableValueType = ({\n  defaultableValue,\n  key,\n  value,\n}: isDefaultableValueInputType) => boolean;\n\nexport type Config = {\n  isDefaultableValue?: isDefaultableValueType;\n  mergeArrays?: boolean;\n};\n\nlet config: Config = {};\n\nexport function setConfig(newConfig: Config): void {\n  config = newConfig;\n}\n\nexport function defaultComposer<T>(...args: Partial<T>[]): T {\n  return args.reduce(compose, args[0]) as T;\n}\n\nfunction compose<T>(defaults: Partial<T>, obj: Partial<T>): Partial<T> {\n  const result: Partial<T> = {};\n  const allKeys = new Set([defaults, obj].flatMap(getAllKeys));\n\n  for (let key of allKeys) {\n    const defaultsValue = defaults[key];\n    const originalObjectValue = hasOwn(obj, key) ? obj[key] : undefined;\n    const hasDefault = hasOwn(defaults, key);\n    const checkOptions = { key, value: originalObjectValue };\n    const defaultableValue = checkDefaultableValue(checkOptions);\n    const defaultableValueFromConfig =\n      config.isDefaultableValue?.({ ...checkOptions, defaultableValue }) ??\n      defaultableValue;\n\n    const shouldTakeDefault = hasDefault && defaultableValueFromConfig;\n\n    if (\n      shouldTakeDefault &&\n      config.mergeArrays &&\n      Array.isArray(defaultsValue) &&\n      Array.isArray(originalObjectValue)\n    ) {\n      result[key] = [...new Set([...defaultsValue, ...originalObjectValue])];\n      continue;\n    }\n\n    if (shouldTakeDefault) {\n      result[key] = defaultsValue;\n      continue;\n    }\n\n    if (isObject(defaultsValue) && isObject(originalObjectValue)) {\n      result[key] = compose(defaultsValue, originalObjectValue);\n      continue;\n    }\n\n    result[key] = originalObjectValue;\n  }\n\n  return result;\n}\n\nfunction isObject(value: any): boolean {\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\n}\n\nfunction isEmptyObjectOrArray<T>(object: T): boolean {\n  if (typeof object !== \"object\" || object === null) return false;\n  return getAllKeys(object).length === 0;\n}\n\nfunction checkDefaultableValue({ value }: { value: unknown }): boolean {\n  return (\n    value === undefined ||\n    value === \"\" ||\n    value === null ||\n    isEmptyObjectOrArray(value) ||\n    (Boolean(config.mergeArrays) && Array.isArray(value))\n  );\n}\n\nfunction hasOwn<T extends PropertyKey>(\n  obj: Partial<Record<T, unknown>>,\n  key: unknown,\n): key is T {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nfunction getAllKeys(object: {}): PropertyKey[] {\n  return [\n    ...Object.keys(object),\n    ...Object.getOwnPropertySymbols(object).filter(\n      (key) => Object.getOwnPropertyDescriptor(object, key)?.enumerable,\n    ),\n  ];\n}\n"],"names":["config","compose","defaults","obj","result","allKeys","Set","flatMap","getAllKeys","key","defaultsValue","originalObjectValue","hasOwn","undefined","hasDefault","checkOptions","value","defaultableValue","checkDefaultableValue","defaultableValueFromConfig","isDefaultableValue","shouldTakeDefault","mergeArrays","Array","isArray","isObject","object","length","Boolean","Object","prototype","hasOwnProperty","call","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","enumerable","args","slice","arguments","reduce","newConfig"],"mappings":"yOAiBA,IAAIA,EAAiB,CAAE,EAUvB,SAASC,EAAWC,EAAsBC,GACxC,MAAMC,EAAqB,CAAA,EACrBC,EAAU,IAAIC,IAAI,CAACJ,EAAUC,GAAKI,QAAQC,IAEhD,IAAK,IAAIC,KAAOJ,EAAS,CACvB,MAAMK,EAAgBR,EAASO,GACzBE,EAAsBC,EAAOT,EAAKM,GAAON,EAAIM,QAAOI,EACpDC,EAAaF,EAAOV,EAAUO,GAC9BM,EAAe,CAAEN,MAAKO,MAAOL,GAC7BM,EAAmBC,EAAsBH,GACzCI,EACJnB,EAAOoB,qBAAqB,IAAKL,EAAcE,sBAC/CA,EAEII,EAAoBP,GAAcK,EAQtCf,EAAOK,GALPY,GACArB,EAAOsB,aACPC,MAAMC,QAAQd,IACda,MAAMC,QAAQb,GAEA,IAAI,IAAIL,IAAI,IAAII,KAAkBC,KAI9CU,EACYX,EAIZe,EAASf,IAAkBe,EAASd,GACxBV,EAAQS,EAAeC,GAIzBA,CACf,CAED,OAAOP,CACT,CAEA,SAASqB,EAAST,GAChB,MAAwB,iBAAVA,GAAgC,OAAVA,IAAmBO,MAAMC,QAAQR,EACvE,CAOA,SAASE,GAAsBF,MAAEA,IAC/B,YACYH,IAAVG,GACU,KAAVA,GACU,OAAVA,GARoB,iBADSU,EAURV,IATsB,OAAXU,GACG,IAA9BlB,EAAWkB,GAAQC,QASvBC,QAAQ5B,EAAOsB,cAAgBC,MAAMC,QAAQR,GAXlD,IAAiCU,CAajC,CAEA,SAASd,EACPT,EACAM,GAEA,OAAOoB,OAAOC,UAAUC,eAAeC,KAAK7B,EAAKM,EACnD,CAEA,SAASD,EAAWkB,GAClB,MAAO,IACFG,OAAOI,KAAKP,MACZG,OAAOK,sBAAsBR,GAAQS,OACrC1B,GAAQoB,OAAOO,yBAAyBV,EAAQjB,IAAM4B,YAG7D,mBA/EgB,WAAwC,IAAlBC,EAAkB,GAAAC,MAAAP,KAAAQ,WACtD,OAAOF,EAAKG,OAAOxC,EAASqC,EAAK,GACnC,cANgB,SAAUI,GACxB1C,EAAS0C,CACX"}